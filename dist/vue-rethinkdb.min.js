/*!
 * vue-rethinkdb v1.0.0
 * (c) 2018 Chad Robinson
 * Released under the MIT License.
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.VueRethinkdb=e.VueRethinkdb||{})}(this,function(e){"use strict";var n=require("rethinkdb"),o={standardCollection:{includeInitial:!0,includeStates:!0,includeOffsets:!0,includeTypes:!0},standardValue:{includeInitial:!0,includeStates:!0,includeTypes:!0}},r=function(e,n,t,i){var o,r,c,s,l,u,f,a,d,p=i.toString();if("[object AtomFeed]"===p)return u=e,(a=i)in(f=t)?f[a]={}:u.util.defineReactive(f,a,{}),d.each(function(e,n){if(e)throw new Error(e);n.new_val&&(f[a]=n.new_val)}),d;if("[object OrderByLimitFeed]"===p)return o=e,l=[],(c=i)in(r=t)?r[c]=l:o.util.defineReactive(r,c,l),s.each(function(e,n){switch(n.type){case"remove":case"uninitial":if(null!=n.old_offset)l.splice(n.old_offset,1);else{var t=l.findIndex(function(e){return e.id===n.old_val.id});if(-1===t)throw new Error("Unable to apply change: "+JSON.stringify(n));l.splice(t,1)}break;case"add":case"initial":null!=n.new_offset?l.splice(n.new_offset,0,n.new_val):l.push(n.new_val);break;case"change":if(null!=n.old_offset&&l.splice(n.old_offset,1),null!=n.new_offset)l.splice(n.new_offset,0,n.new_val);else{var i=l.findIndex(function(e){return e.id===n.old_val.id});if(-1===i)throw new Error("Unable to apply change: "+JSON.stringify(n));l[i]=n.new_val}break;case"state":break;default:throw new Error('Unrecognized "type" field from server: '+JSON.stringify(n))}}),s;throw new Error('Field "'+t+'" has unsupported feed type '+p)},c={install:function(i,e){c.options=e||{},(i.RethinkDB=c).getConnection(),i.mixin({created:function(){var e=this,t=e.$options&&e.$options.rethinkDB?e.$options.rethinkDB.call(this,n,o):null;t&&(e.$rethinkCursors=Promise.all(Object.keys(t),function(n){return c.getConnection().then(function(e){return t[n].run(e).then(function(e){return r(i,0,n,e)})})}))},beforeDestroy:function(){var e=this;e.$rethinkCursors&&(e.$rethinkCursors.forEach(function(e){return e.close()}),delete e.$rethinkCursors)}})},getConnection:function(){if(c.conn)return Promise.resolve(c.conn);c.pendingConnections=c.pendingConnections||[];var e=new Promise(function(e,n){c.pendingConnections.push({resolve:e,reject:n})});return 1===c.pendingConnections.length&&(console.log("VueRethinkDB: Connecting...",c.options),n.connect(c.options).then(function(n){console.log("VueRethinkDB: Connected!"),c.conn=n,c.pendingConnections.map(function(e){return e.resolve(n)}),delete c.pendingConnections}).catch(function(n){console.error("VueRethinkDB: Connection error",n),c.pendingConnections.map(function(e){return e.reject(n)})})),e}};e.default=c,Object.defineProperty(e,"__esModule",{value:!0})});